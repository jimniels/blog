#myBlog #quickChartIo

# Multiple Inline SVGs (From QuickChart)

‚Äúmultiple inline svg clip-path url id namespace collision quickchart.io‚Äù

üëÜ That is the keyword search for my problem. I‚Äôm not finding any results related specifically to this problem and using quickchart.io, so here‚Äôs my contribution to the internet and future person who has a similar keyword search.

---

I‚Äôm working on generating some stats and accompanying graphs for my blog (blog post to come on this‚Ä¶).

For the charts, I‚Äôm using the [quickchart.io](https://quickchart.io) API (a tool I‚Äôve [used](/2022/visualizing-my-blogs-links/) [before](https://blog.jim-nielsen.com/2021/graphing-blog-post-goals/)) and it‚Äôs beautifully simple: pass data as a URL, get back a chart.

It‚Äôs working. My build hits the quickchart API, gets an SVG, and inlines it into my HTML. It looks great!

<img src="https://cdn.jim-nielsen.com/blog/2022/inline-svgs-graph-works.png" width="704" height="426" alt="" />

Until I try to add more than one SVG to the page. Then the charts look empty.

<img src="https://cdn.jim-nielsen.com/blog/2022/inline-svgs-graph-doesnt-work.png" width="702" height="426" alt="" />

Which is weird, because they don‚Äôt look that way when I look at them in the file browser. Or at their own URLs on my local server.

Which, come to think of it, can only mean one thing: inlining them into the HTML is what‚Äôs causing the bug. But what‚Äôs the bug?

I open the developer tools and see the empty chart has a bunch of `clip-path` attributes pointing to `<clipPath>` definitions in the SVG using generic ID names (which are automatically generated by quickchart.io).

<img src="https://cdn.jim-nielsen.com/blog/2022/inline-svgs-dev-tools.png" width="728" height="677" alt="" />

Ah-ha! QuickChart is generating SVGs with the same generic naming pattern for IDs (`clip1`, `clip2`, `clip3`, etc.). When multiple SVGs from QuickChart get embedded in the same document, they clobber each other‚Äôs namespace!

In other words: `clip-path="url(#clip1)"` is finding the first `<clipPath id="clip1">` in the current document, which normally is its own SVG document. But this SVG document is embedded in an HTML document with other SVG documents using the same IDs, so they clash.

‚ÄúJust reference the SVG as an `<img>` and it‚Äôll work,‚Äù you might be thinking. But I need styling control over these SVGs, so `<img>` doesn‚Äôt work.

So I turn to the perenially-great, kiwi bird CSS tricks article on [using SVG](https://css-tricks.com/using-svg/).

It looks like `<object>` is my best bet, as it‚Äôs the one that‚Äôll still give me styling control. But I quickly realize its styling is local to the SVG itself, meaning it can‚Äôt inherit styles from the parent HTML document which is exactly what I want and need.

So now my options are: 1) duplicate the CSS/JS that controls the themeing in my parent HTML document so it works in each individual `<object>` SVG, or 2) find another solution.

I‚Äôll find another solution.

I start to wonder, ‚ÄúWhen embedding an SVG in an HTML document, is there a way to scope IDs to the parent `<svg>` element?‚Äù I realize [IDs must be unique per document](https://stackoverflow.com/questions/37000385/multiple-svg-with-same-ids) but SVGs _are_ documents too, right? But I guess they‚Äôre not when embedded in HTML. 

I get it, what I‚Äôm asking for here is to have my cake and eat it too: I want the SVG to be part of the document when it‚Äôs convenient to me (to inherit the parent document‚Äôs styling) but not when it‚Äôs inconvenient for me (ID name collision).

It would be cool if you could scope ID naming, kind of like [donut scope in CSS](https://css-tricks.com/weekly-platform-news-focus-rings-donut-scope-ditching-em-units-and-global-privacy-control/#aa-the-enhanced-css-not-selector-enables-donut-scope), to a specific area or parent. AFAIK something like this doesn‚Äôt exist (hit me up if you know something I don‚Äôt) but I kinda wish it did:

```html
<html>
  <body>
    <h1>My Charts</h1>
    
    <h2>Generated Chart #1</h1>
    <!-- Set some attribute so ID names go past here -->
    <div scope-id="true">
      <!-- Embedded SVG. Example: -->
      <svg>
	      <defs>
	        <clipPath id="clip1">‚Ä¶</clipPath>
	      </defs>
	      <g clip-path="url(#clip1)">‚Ä¶</g>
	    </svg>
    </div>
    
    <h2>Generated Chart #2</h1>
    <div scope-id="true">
      <!-- Embedded SVG. Example: -->
      <svg>
        <defs>
          <clipPath id="clip1">‚Ä¶</clipPath>
        </defs>
        <g clip-path="url(#clip1)">‚Ä¶</g>
      </svg>
    </div>
  </body>
</html>
```

The use case here seems like a pretty common one? Use a tool to generate multiple SVGs, then inline them into the same HTML document without clobbering each other. As a poster on StackOverlow [put it](https://stackoverflow.com/questions/15911717/clippath-in-multiple-svg-tags#comment44570352_15913124):

> SVGs are often pulled in from a variety of sources and for it to fall to the user to have to parse and re-pseudo-namespace everything to avoid potential clashes is pretty unfriendly.

Ultimately, what I need is multiple `<svg>` elements inlined to the same document for styling control. The pattern QuickChart uses for generating IDs is pretty straightforward (and from what I can tell, not configurable through the API), so I do what any reasonable person does when you need to tweak strings you have no control over: I reach for a regex.

```js
/**
 * Take an SVG from QuickChart like this:
 * <svg>
 *   <defs>
 *     <clipPath id="clip1">‚Ä¶</clipPath>
 *   </defs>
 *   <g clip-path="url(#clip1)">‚Ä¶</g>
 * </svg>
 *
 * And make each ID unique by prepending a string:
 *
 * <svg>
 *   <defs>
 *     <clipPath id="my-unique-id__clip1">‚Ä¶</clipPath>
 *   </defs>
 *   <g clip-path="url(#my-unique-id__clip1)">‚Ä¶</g>
 * </svg>
 */
function uniquezSvg(svg, id) {
  return svg
    .replace(
      /id="clip/g,
      `id="${id}__clip`
    )
    .replace(
      /clip-path="url\(#clip/g,
      `clip-path="url(#${id}__clip`
    );
}

// Use it, e.g.
const svg = await fetchQuickChartSvg(‚Ä¶);
const newSvg = uniquezSvg(svg, "my-unique-id");
```

Boom, done. This rewrites the IDs for clip paths in SVGs generated by QuickChart so they can be embedded into the same HTML document.

This story brought to you by another day tinkering on my website.

## Update 2022-09-18

[@simevidas suggested on Twitter](https://twitter.com/simevidas/status/1571550770088091651) a parent-level ID prefix that all children would then inherit for their IDs, which I kind of like. Example:


```html
<div id-prefix="chart-">
  <!-- Resulting id would be "chart-bar1" -->
  <svg id="bar1">‚Ä¶</svg>
    <!-- Resulting id would be "chart-bar2" -->
  <svg id="bar2">‚Ä¶</svg>
</div>
```

I‚Äôm not quite sure how you'd represent that in the DOM of the devtools, cause there‚Äôs a difference between what‚Äôs written in the original HTML and what the browser interprets it as ‚Äì but I still kinda like the idea.