---
(site, path) => {

  // Pulled from the CSS theme variables
  colors: [
  "red",
  "blue",
  "green",
  "yellow",
  // "pink",
  "purple",
  // "none",
  // "orange",
  // not supported as UI themes—yet
  // "mint",
  // "teal",
  // "cyan",
  // "brown",
  // "indigo",
  ],

  appearances: ["system", "light", "dark"],

  // Abstract hx-* values into function

  hxValues = (get) => path !== "/menu/" ? `hx-get="${get}" hx-target="main" hx-swap="outerHTML transition:true" hx-select="main" hx-push-url="true"` : ""

  return = _template()
}.return
---

<nav class="nav" id="nav">
  <h2 class="nav-label">Jim Nielsen’s Blog</h2>
  <ul>
    <li>
      <a
        href="/"
        ${hxValues("/")}
        class="nav-list-item"
        aria-current="${path === '/' ? 'page' : 'false'}"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-home.svg}
        </span>
        <span class="nav-list-item__label">Home</span>
      </a>
    </li>
    <li>
      <a
        href="/search/"
        ${hxValues("/search/")}
        class="nav-list-item"
        aria-current="${path === '/search/' ? 'page' : 'false'}"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-search.svg}
        </span>
        <span class="nav-list-item__label">Search</span>
      </a>
    </li>

    <li>
      <a
        href="/subscribe/"
        ${hxValues("/subscribe/")}
        aria-current="${path === '/subscribe/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">${server/svgs/heroicon-rss.svg}</span>
        <span class="nav-list-item__label">Subscribe</span>
      </a>
    </li>
  </ul>

  <h2 class="nav-label">Posts</h2>
  <ul>
    <li>
      <a
        href="/posts/trending/"
        ${hxValues("/posts/trending/")}
        aria-current="${path === '/posts/trending/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-trending.svg}
        </span>
        <span class="nav-list-item__label">Trending</span>
      </a>
    </li>
    <li>
      <a
        href="/posts/hacker-news/"
        ${hxValues("/posts/hacker-news/")}
        aria-current="${path === '/posts/hacker-news/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">${server/svgs/hacker-news.svg}</span>
        <span class="nav-list-item__label">HN Hits</span>
      </a>
    </li>

    <li>
      <a
        href="/archive/"
        ${hxValues("/archive/")}
        aria-current="${path === '/archive/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-archive.svg}
        </span>
        <span class="nav-list-item__label">Archive</span>
      </a>
    </li>
    <li>
      <a
        href="/posts/personal-favorites/"
        ${hxValues("/posts/personal-favorites/")}
        aria-current="${path === '/posts/personal-favorites/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-star.svg}
        </span>
        <span class="nav-list-item__label">Personal Favs</span>
      </a>
    </li>
  </ul>

  <h2 class="nav-label">Meta</h2>
  <ul>
    <li>
      <a
        href="/about/external-links/"
        ${hxValues("/about/external-links/")}
        aria-current="${path === '/about/external-links/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-outlinks.svg}
        </span>
        <span class="nav-list-item__label">External Links</span>
      </a>
    </li>
    <li>
      <a
        href="/about/internal-links/"
        ${hxValues("/about/internal-links/")}
        aria-current="${path === '/about/internal-links/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-inlinks.svg}
        </span>
        <span class="nav-list-item__label">Internal Links</span>
      </a>
    </li>
    <li>
      <a
        href="/about/"
        ${hxValues("/about/")}
        aria-current="${path === '/about/' ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__icon">
          ${server/svgs/heroicon-about.svg}
        </span>
        <span class="nav-list-item__label">About</span>
      </a>
    </li>
  </ul>

  <h2 class="nav-label">Posts by Year</h2>
  <ul>
    ${Tree.map(Tree.reverse(site.postIdsByYear), (postIds, year) => `
    <li>
      <a
        href="/${year}/"
        ${hxValues(`/${year}/`)}
        aria-current="${path === `/${year}/` ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__label">${year}</span>
        <span class="nav-list-item__meta">${postIds.length}</span>
      </a>
    </li>
    `)}
  </ul>
  <h2 class="nav-label">Posts by Tag</h2>
  <ul>
    ${Tree.map(site.postIdsByTag, (postIds, tag) => `
    <li>
      <a
        href="/tags/${tag}/"
        ${hxValues(`/tags/${tag}/`)}
        aria-current="${path === (`/tags/${tag}/`) ? 'page' : 'false'}"
        class="nav-list-item"
      >
        <span class="nav-list-item__label">#${tag}</span>
        <span class="nav-list-item__meta">${postIds.length}</span>
      </a>
    </li>
    ` )}
  </ul>

  <h2 class="nav-label">Accent</h2>
  <form class="theme-picker">
    ${Tree.map(colors, (color) => `
    <input type="radio" name="color" value="${color}" id="color-${color}" />
    <label for="color-${color}" class="nav-list-item">
      <span class="nav-list-item__icon">
        <span
          style="
            background-color: hsl(
              var(--c-${color}-h) var(--c-${color}-s) var(--c-${color}-l)
            );
          "
        ></span>
      </span>
      <span class="nav-list-item__label" style="text-transform: capitalize">
        ${color}
      </span>
      <span class="nav-list-item__meta">${server/svgs/heroicon-check.svg}</span>
    </label>
    ` )}
  </form>

  <h2 class="nav-label">Appearance</h2>
  <form class="theme-picker">
    ${Tree.map(appearances, (theme) => `
    <input
      type="radio"
      name="appearance"
      value="${theme}"
      id="appearance-${theme}"
    />
    <label for="appearance-${theme}" class="nav-list-item">
      <span class="nav-list-item__icon">
        ${server/svgs[`heroicon-${theme}.svg`]}
      </span>
      <span class="nav-list-item__label">${theme}</span>
      <span class="nav-list-item__meta">${server/svgs/heroicon-check.svg}</span>
    </label>
    ` )}
  </form>

  <theme-picker></theme-picker>
  <script>
    ${server/theme-picker.js}
  </script>
</nav>

${path !== `/menu/` ? `
<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>
<script>
  // TODO: don't do htmx if is mobile
  document.body.addEventListener("htmx:afterSwap", function (event) {
    window.scrollTo(0, 0);

    // event.detail.target is the swapped element
    const path = event.detail.pathInfo.requestPath;

    // We might be on a post page, for example, which doesn't have an active sidebar link
    const currentlyActiveEl = document.querySelector(
      "#nav a[aria-current='page']"
    );
    if (currentlyActiveEl) {
      currentlyActiveEl.setAttribute("aria-current", "false");
    }

    console.log(path);
    document
      .querySelector("#nav a[href='" + path + "']")
      .setAttribute("aria-current", "page");
  });
</script>
` : ""}