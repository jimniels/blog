---
(site) => {
  posts = site.posts
    -> (posts) => Tree.filter(posts, (post) => !(post.tags && post.tags.includes("rssClub")))
    -> (posts) => Tree.take(posts, 3)
    -> Tree.values
    -> Tree.plain
  trendingPosts = site.posts
    -> (posts) => Tree.filter(posts, (post) => post.hasOwnProperty("pageviews"))
    -> (posts) => Tree.sort(posts, (post) => (post.pageviews))
    -> (posts) => Tree.take(posts, 3)
    -> Tree.reverse
    -> Tree.values
    -> Tree.plain
  
  hackerNewsPosts = site.posts
    -> (posts) => Tree.filter(posts, (post) => post.hackerNews)
    -> (posts) => Tree.sort(posts, (post) => (post.hackerNews.points))
    -> (posts) => Tree.take(posts, 3)
    -> Tree.reverse
    -> Tree.values
    -> Tree.plain
  page: {
    title: "",
    path: "/",
  },
  
  return = server/Layout.ori.html({ site, page }, _template())
}.return
---

<main class="wrapper">
  <h1>Jim’s Blog</h1>
  <p>
    I’m
    <a href="https://www.jim-nielsen.com">Jim Nielsen</a>
    and this is my blog. Warning: these are opinions with a shelf life.
  </p>

  <h2 style="margin-top: var(--s-40)">Latest</h2>
  ${server/PostsList.js(posts)}
  <p style="font-size: 0.875rem; text-align: right">
    <a href="/archive/">View all ${site.posts.length} posts ›</a>
  </p>
  <br />

  <h2>Trending</h2>
  ${server/PostsList.js( trendingPosts, (post) => ` ${post.pageviews > 1000 ?
  Math.round((post.pageviews / 1000) * 10) / 10 + "k" : post.pageviews}
  pageviews` )}
  <p style="font-size: 0.875rem; text-align: right">
    View all
    <a href="/posts/trending/">trending posts ›</a>
  </p>
  <br />

  <h2>Hacker News Hits</h2>
  ${server/PostsList.js( hackerNewsPosts, (post) =>
  `${post.hackerNews.points.toLocaleString()} points,
  ${post.hackerNews.comments.toLocaleString()} comments` )}
  <p style="font-size: 0.875rem; text-align: right">
    View all my
    <a href="/posts/hacker-news/">Hacker News hits ›</a>
  </p>
  <br />
</main>
