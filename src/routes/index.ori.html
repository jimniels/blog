---
(site) => {
  posts = site.posts
    -> (posts) => Tree.filter(posts, (post) => !(post.tags && post.tags.includes("rssClub")))
    -> (posts) => Tree.take(posts, 3)
    -> Tree.values
    -> Tree.plain
  trendingPosts = site.posts
    -> (posts) => Tree.filter(posts, (post) => post.hasOwnProperty("pageviews"))
    -> (posts) => Tree.sort(posts, (post) => (post.pageviews))
    -> Tree.reverse
    -> (posts) => Tree.take(posts, 3)
    -> Tree.values
    -> Tree.plain
  hackerNewsPosts = site.posts
    -> (posts) => Tree.filter(posts, (post) => post.hackerNews && post.hackerNews.points > 100)
    -> (posts) => Tree.sort(posts, (post) => (post.hackerNews.points))
    -> Tree.reverse
    -> (posts) => Tree.take(posts, 3)
    -> Tree.values
    -> Tree.plain
  
  page: {
    title: "",
    path: "/",
  },
  
  return = <server/Layouts.js>.Page({ site, page }, _template())
}.return
---

<main class="wrapper">
  <h1>Jim’s Blog</h1>

  <p style="margin-top: calc(var(--s-12) * -1)">
    Opinions with a shelf life. Made by
    <a href="https://www.jim-nielsen.com">me</a>
    .
  </p>

  <h2 style="margin-top: var(--s-40)">Latest</h2>
  ${server/PostsList.js(posts)}
  <p style="font-size: 0.875rem; text-align: right">
    <a href="/archive/">View all →</a>
  </p>

  <h2 style="view-transition-name: h1-heading-trending">Trending</h2>
  <!-- prettier-ignore -->
  ${server/PostsList.js( trendingPosts, (post) =>
    `${post.pageviews > 1000
      ? Math.round((post.pageviews / 1000) * 10) / 10 + "k"
      : post.pageviews} pageviews`
  )}
  <p style="font-size: 0.875rem; text-align: right">
    <a href="/posts/trending/">View all →</a>
  </p>

  <h2 style="view-transition-name: h1-heading-hacker-news">Hacker News Hits</h2>
  <!-- prettier-ignore -->
  ${server/PostsList.js( hackerNewsPosts, (post) =>
    `${post.hackerNews.points.toLocaleString()} points, ${post.hackerNews.comments.toLocaleString()} comments`
  )}
  <p style="font-size: 0.875rem; text-align: right">
    <a href="/posts/hacker-news/">View all →</a>
  </p>
</main>
