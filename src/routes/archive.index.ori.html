---
(site) => { 
  page = {
    title: "Archive",
    path: "/archive/",
    head: `
      <style>
        @view-transition {
          navigation: none;
        }
        main h2,
        main h3 {
          height: 1.5rem;
          width: 50%;
          background: var(--c-bg);
          position: sticky;
          top: 0px;
          margin-bottom: 0;
        }
        main h2 {
          z-index: 10;
          
        }
        main h3 {
          z-index: 11;
          
          text-align: right;
          margin-left: 50%;
        }

        .archive-chart {
          display: flex;
          flex-direction: column;
          list-style: none;
          margin: 0;
          padding: 0;
          gap: var(--s-2);
          font-size: 0.777rem;
        }

        .archive-chart li {
          position: relative;
        }

        .archive-chart li a {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: var(--s-6) var(--s-6);
          position: relative;
          z-index: 2;
          text-decoration: none;
        }
        .archive-chart li a span:last-child {
          color: var(--c-text-light);
          font-size: 0.666rem;
        }
        .archive-chart li a:hover span:first-child {
          text-decoration: underline;
        }
        .archive-chart-bar {
          position: absolute;
          top: 0;
          left: 0;
          height: 100%;
          background: var(--c-fg);
          pointer-events: none;
          z-index: 1;
        }
      </style>
    `
  }

  // { 2025: [{...}], 2024: [{...}], ... }
  postsByYear = site.posts 
    -> (posts) => Tree.group(posts, (post) => new Date(post.date).getFullYear().toString())
    -> Tree.reverse

  // { 2025: { 0: [{...}], 1: [{...}], ... }, 2024: { 0: [{...}], 1: [{...}], ... }, ... }
  postsByYearThenMonth = Tree.map(
    postsByYear,
    {
      key: (posts, year) => year,
      // Note: months are 0-indexed, so we add 1 to get the correct month in display
      value: (posts) => Tree.group(posts, (post) => new Date(post.date).getMonth() + 1) -> Tree.reverse
    }
  )

  // { 2025: 10, 2024: 10, ... }
  postCountsByYear = Tree.map(postsByYear, (posts) => posts.length)
  
  // 10
  maxPostCount = (Tree.sort(postCountsByYear, (count) => count) -> Tree.reverse -> Tree.values)[0]

  return = <server/Layouts.js>.Page({ site, page }, _template())
}.return
---

<main class="wrapper">
  <h1>Archive</h1>
  <p>
    The is all of it â€” ${site.posts.length} posts across ${new
    Date().getFullYear() - 2012} years. All available for free (you get what you
    pay for).
  </p>
  ${/*
  <ol class="archive-chart">
    ${Tree.map(postCountsByYear, (postCount, year) => `
    <li>
      <a href="#${year}">
        <span>${year}</span>
        <span>${postCount} posts</span>
      </a>
      <span
        class="archive-chart-bar"
        style="width: ${(postCount / maxPostCount) * 100}%"
      ></span>
    </li>
    ` )}
  </ol>
  */""} ${Tree.map(postsByYearThenMonth, (postsByMonth, year) => `
  <h2>${year}</h2>
  ${Tree.map(postsByMonth, (posts, month) => `
  <h3>
    ${Intl.DateTimeFormat('en', { month: 'short' }).format(new Date(month))}
  </h3>
  ${<server/PostsList.js>(Tree.plain(posts))} `)} `)}
</main>
