---
(site) => {
  postsByYear = Tree.group(site.posts, (post) => post.date.slice(0, 4))
  yearsSorted = Tree.keys(postsByYear).sort().reverse()
  fn = (post) => `<time datetime="{post.date}">{post.date.slice(5, 10)}</time>`
  // postsByYear = site.posts
  //   .filter((post) => !post?.tags.includes("rssClub"))
  //   .reduce((acc, post) => {
  //     const year = post.date.slice(0, 4);
  //     if (acc[year]) {
  //       acc[year].push(post);
  //     } else {
  //       acc[year] = [post];
  //     }
  //     return acc;
  //   }, /** @type {{ [key: string]: import('types').Post[] }} */ ({}))
  return = <server/Layouts.js>.Page(
    {
      site,
      page: { title: "Archive", path: "/archive/" },
    },
    _template()
  )
}/return
---

<main>
  <h1 class="wrapper">Archive</h1>
  ${ /* MOVE TO STATS
  <div class="wrapper">
    <h1>Archive</h1>
    <ol class="archive-chart">
      ${yearsSorted.map( (year) => html`
      <li>
        <a href="#${year}">
          <span>${year}</span>
          <span>${postsByYear[year].length}</span>
        </a>
        <span
          class="archive-chart-bar"
          style="width: ${(postsByYear[year].length / maxPosts) * 100}%"
        ></span>
      </li>
      ` )}
    </ol>
  </div>
  */ "" }
  <div class="wrapper-grid">
    ${Tree.map(Tree.reverse(Tree.sort(postsByYear)), (posts, year) => `
    <h2 id="${year}" style="margin: 2rem 0 0.5rem">${year}</h2>
    ${<server/PostsList.js>.PostsList(Tree.plain(posts), fn, true )} `)}
  </div>
</main>
<style>
  @view-transition {
    navigation: none;
  }
  main h2 {
    position: sticky;
    top: 0px;
    background: var(--c-bg);
    z-index: 10;
    zfont-size: 1rem;
    font-weight: 800;
  }

  .archive-chart {
    display: flex;
    flex-direction: column;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: var(--s-2);
    font-size: 0.777rem;
  }

  .archive-chart li {
    position: relative;
  }

  .archive-chart li a {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--s-6) var(--s-6);
    position: relative;
    z-index: 2;
    text-decoration: none;
  }
  .archive-chart li a span:last-child {
    color: var(--c-text-light);
    font-size: 0.666rem;
  }
  .archive-chart li a:hover span:first-child {
    text-decoration: underline;
  }
  .archive-chart-bar {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: var(--c-fg);
    pointer-events: none;
    z-index: 1;
  }
</style>
